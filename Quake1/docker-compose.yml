version: '3.9'

services:
  wireguard:
    image: linuxserver/wireguard
    container_name: wireguard
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Stockholm
      - SERVERURL=[2a09:bac3:53c5:28c::41:11a]   # <-- DIN PUBLIKA IP, Ã¤ndra vid behov
      - SERVERPORT=51820
      - PEERS=7
      - PEERDNS=1.1.1.1
    volumes:
      - ./wg-config:/config
      - /lib/modules:/lib/modules
    ports:
      - "51820:51820/udp"
    restart: unless-stopped
    networks:
      - quake_net

  quake_server:
    image: moisesber/quaken:latest
    platform: linux/amd64
    container_name: Kabelz_quake_server
    ports:
      - "26000:26000/udp"
    volumes:
      - ./quake_data/id1:/nquakesv/id1
      - ./quake_data/maps:/nquakesv/id1/maps
      - ./quake_data/mods:/nquakesv/id1/mods
      - ./quake_data/logs:/nquakesv/logs
    restart: unless-stopped
    networks:
      - quake_net

  web_dashboard:
    image: nginx:alpine
    container_name: quake_dashboard
    ports:
      - "8080:80"
    volumes:
      - ./quake_data/logs:/usr/share/nginx/html:ro
    restart: unless-stopped
    networks:
      - quake_net

  backup:
    image: alpine:latest
    container_name: quake_backup
    command: sh -c "while true; do cp -r /quake_data /backup/quake_data_$(date +%F_%H%M%S); sleep 3600; done"
    volumes:
      - ./quake_data:/quake_data
      - ./backups:/backup
    restart: unless-stopped
    networks:
      - quake_net

networks:
  quake_net:
    driver: bridge